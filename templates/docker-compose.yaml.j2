jenkins:
  image: jenkins/jenkins:{{ jenkins_version }}
  environment:
    JAVA_OPTS: {{ jenkins_java_opts }}
  log_driver: "syslog"
  log_opt:
    tag: "jenkins-proxy"
  ports:
    - "{{ jenkins_port }}:{{ jenkins_port }}"
    - "50000:50000"
  volumes:
    - {{ jenkins_home }}:/var/jenkins_home
    - {{ jenkins_logs }}:/var/log/jenkins
    - /etc/localtime:/etc/localtime:ro
    - /app/logging.properties:/etc/logging.properties

nginx:
  user: root
  image: nginx:latest
  container_name: nginx
  ports:
    - "{{ nginx_http_port }}:{{ nginx_http_port }}"
    - "{{ nginx_https_port }}:{{ nginx_https_port }}"
  links:
    - jenkins:jenkins
  volumes:
    - "{{ nginx_conf }}":/etc/nginx/conf.d/default.conf
    - "{{ nginx_tls }}"/server.crt:/etc/nginx/ssl/server.crt
    - "{{ nginx_tls }}"/server.key:/etc/nginx/ssl/server.key
  restart: always
